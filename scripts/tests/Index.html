<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <script src="../require.js" type="text/javascript"></script>
    <script src="../jquery-1.7.2.js" type="text/javascript"></script>
    <script src="../qunit/qunit.js" type="text/javascript"></script>
    <link href="../qunit/qunit.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<script type="text/javascript">
    $(function () {
        var iframe = window.frames["loadediframe"];
        var getContext = function() {
            return iframe.window;
        };

        module("TaskController");

        test("When adding a new task", function () {
                var context = getContext();
                var taskController = context.taskController;
                var detailController = context.detailController;

                taskController.addTask();
                equals(context.location.hash, "#task-details", "Then the new task screen is shown");

                $("#task-title", iframe.document).val("hello from test");
                var item = detailController.saveTask();
                var loaded = context.Task.find(item.id);
                equals(item.id, loaded.id, "Then the new task was saved");

                $("[name='delete'][value='"+item.id+"']", iframe.document).click();
                equals(false, context.Task.exists(item.id), 'The task is destroyed');
        });
    });
</script>

<h1 id="qunit-header">QUnit HomeController Tests</h1>

<h2 id="qunit-banner"></h2>

<h2 id="qunit-userAgent"></h2>
<ol id="qunit-tests"></ol>
<div id="qunit-fixture">
    <iframe id="loadediframe" name="loadediframe" style="" src="../../Index.html" width="400"></iframe>
</div>

</body>
</html>